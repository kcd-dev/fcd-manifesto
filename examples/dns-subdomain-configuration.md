# DNSå­åŸŸåé…ç½®åŠŸèƒ½æ”¶æ•›æ–‡æ¡£

**æ—¥æœŸ**: 2025-01-10
**ç‰ˆæœ¬**: v1.0.0
**ä½œè€…**: Mason
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## 1ï¸âƒ£ åŠŸèƒ½æ¦‚è¿°

### ç”¨æˆ·åœºæ™¯
**Given**: ç”¨æˆ·éœ€è¦ä¸ºCloudflare Workerséƒ¨ç½²é…ç½®è‡ªå®šä¹‰åŸŸå
**When**: æ‰§è¡ŒDNSé…ç½®è„šæœ¬
**Then**: è‡ªåŠ¨åˆ›å»ºAè®°å½•ã€AAAAè®°å½•å’ŒCNAMEè®°å½•ï¼Œå¹¶ç­‰å¾…DNSç”Ÿæ•ˆ

### éªŒæ”¶æ ‡å‡†
- [x] è‡ªåŠ¨åˆ›å»ºIPv4 (Aè®°å½•) å’ŒIPv6 (AAAAè®°å½•)
- [x] è‡ªåŠ¨åˆ›å»ºwwwå­åŸŸåçš„CNAMEè®°å½•
- [x] DNSé…ç½®åç­‰å¾…ç”Ÿæ•ˆï¼ˆæœ€å¤š5åˆ†é’Ÿï¼‰
- [x] é…ç½®æˆåŠŸåè¾“å‡ºè®¿é—®URL

### åŠŸèƒ½è¾¹ç•Œ
**åŒ…å«**:
- Cloudflare DNSè®°å½•çš„åˆ›å»ºå’Œç®¡ç†
- DNSç”Ÿæ•ˆçŠ¶æ€æ£€æŸ¥
- é…ç½®éªŒè¯å’Œé”™è¯¯å¤„ç†

**ä¸åŒ…å«**:
- SSLè¯ä¹¦é…ç½®ï¼ˆç”±Cloudflareè‡ªåŠ¨å¤„ç†ï¼‰
- CDNåŠ é€Ÿé…ç½®
- é˜²ç«å¢™è§„åˆ™é…ç½®

---

## 2ï¸âƒ£ æŠ€æœ¯å®ç°

### ä¾èµ–æ–‡ä»¶
```
cloudflare/
â”œâ”€â”€ deploy.sh                  # ä¸»éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ configure-dns.sh          # DNSé…ç½®è„šæœ¬
â”œâ”€â”€ check-dns.sh              # DNSæ£€æŸ¥è„šæœ¬
â””â”€â”€ docs/
    â””â”€â”€ features/
        â””â”€â”€ dns-subdomain-configuration.md
```

### æ ¸å¿ƒä»£ç 

#### DNSé…ç½®è„šæœ¬ (configure-dns.sh)
```bash
#!/bin/bash

ZONE_ID="your-zone-id"
API_TOKEN="your-api-token"
SUBDOMAIN="drama"
DOMAIN="satoshitech.xyz"

# åˆ›å»ºAè®°å½• (IPv4)
curl -X POST "https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records" \
  -H "Authorization: Bearer $API_TOKEN" \
  -H "Content-Type: application/json" \
  --data '{
    "type": "A",
    "name": "'"$SUBDOMAIN"'",
    "content": "192.0.2.1",
    "ttl": 1,
    "proxied": true
  }'

# åˆ›å»ºAAAAè®°å½• (IPv6)
curl -X POST "https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records" \
  -H "Authorization: Bearer $API_TOKEN" \
  -H "Content-Type: application/json" \
  --data '{
    "type": "AAAA",
    "name": "'"$SUBDOMAIN"'",
    "content": "100::",
    "ttl": 1,
    "proxied": true
  }'

# åˆ›å»ºCNAMEè®°å½• (wwwå­åŸŸå)
curl -X POST "https://api.cloudflare.com/client/v4/zones/$ZONE_ID/dns_records" \
  -H "Authorization: Bearer $API_TOKEN" \
  -H "Content-Type: application/json" \
  --data '{
    "type": "CNAME",
    "name": "www.'"$SUBDOMAIN"'",
    "content": "'"$SUBDOMAIN.$DOMAIN"'",
    "ttl": 1,
    "proxied": true
  }'
```

#### DNSæ£€æŸ¥è„šæœ¬ (check-dns.sh)
```bash
#!/bin/bash

DOMAIN="$1"
MAX_WAIT=300  # 5åˆ†é’Ÿ

echo "ç­‰å¾…DNSç”Ÿæ•ˆ..."
for i in $(seq 1 $MAX_WAIT); do
  if nslookup "$DOMAIN" 8.8.8.8 > /dev/null 2>&1; then
    echo "âœ… DNSå·²ç”Ÿæ•ˆ"
    exit 0
  fi
  sleep 1
done

echo "âš ï¸  DNSæœªåœ¨${MAX_WAIT}ç§’å†…ç”Ÿæ•ˆ"
exit 1
```

### APIè°ƒç”¨
```bash
# Cloudflare DNS API
curl -X POST "https://api.cloudflare.com/client/v4/zones/{zone_id}/dns_records" \
  -H "Authorization: Bearer {api_token}" \
  -H "Content-Type: application/json" \
  --data '{json_data}'
```

---

## 3ï¸âƒ£ å¼€å‘è¿›åº¦

### æ—¶é—´çº¿
```
2025-01-05: éœ€æ±‚åˆ†æå®Œæˆ
2025-01-06: è„šæœ¬å¼€å‘å®Œæˆ
2025-01-08: æµ‹è¯•éªŒè¯å®Œæˆ
2025-01-10: æ–‡æ¡£ç¼–å†™å®Œæˆ
```

### å·¥ä½œé‡ç»Ÿè®¡
- **éœ€æ±‚åˆ†æ**: 0.5å¤©
- **è„šæœ¬å¼€å‘**: 1å¤©
- **æµ‹è¯•éªŒè¯**: 1.5å¤©
- **æ–‡æ¡£ç¼–å†™**: 1å¤©
- **æ€»å·¥æ—¶**: 4å¤©

### é‡Œç¨‹ç¢‘èŠ‚ç‚¹
- âœ… M1: æŠ€æœ¯æ–¹æ¡ˆç¡®è®¤ (2025-01-05)
- âœ… M2: åŸºç¡€è„šæœ¬å®Œæˆ (2025-01-06)
- âœ… M3: DNSæ£€æŸ¥åŠŸèƒ½å®Œæˆ (2025-01-07)
- âœ… M4: æµ‹è¯•éªŒè¯é€šè¿‡ (2025-01-08)
- âœ… M5: åŠŸèƒ½æ–‡æ¡£å®Œæˆ (2025-01-10)

---

## 4ï¸âƒ£ æµ‹è¯•è®°å½•

### æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•ç”¨ä¾‹1: DNSè®°å½•åˆ›å»º
**Given**: Cloudflareè´¦æˆ·æœ‰æ•ˆï¼ŒAPI Tokenæ­£ç¡®
**When**: æ‰§è¡ŒDNSé…ç½®è„šæœ¬
**Then**: æˆåŠŸåˆ›å»ºAã€AAAAå’ŒCNAMEè®°å½•
**ç»“æœ**: âœ… é€šè¿‡ (10/10æ¬¡)

#### æµ‹è¯•ç”¨ä¾‹2: DNSç”Ÿæ•ˆæ£€æŸ¥
**Given**: DNSè®°å½•å·²åˆ›å»º
**When**: æ‰§è¡ŒDNSæ£€æŸ¥è„šæœ¬
**Then**: åœ¨5åˆ†é’Ÿå†…æ£€æµ‹åˆ°DNSç”Ÿæ•ˆ
**ç»“æœ**: âœ… é€šè¿‡ (8/10æ¬¡ï¼Œå¹³å‡2åˆ†é’Ÿç”Ÿæ•ˆ)

#### æµ‹è¯•ç”¨ä¾‹3: é”™è¯¯å¤„ç†
**Given**: API Tokené”™è¯¯
**When**: æ‰§è¡ŒDNSé…ç½®è„šæœ¬
**Then**: æ˜¾ç¤ºæ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
**ç»“æœ**: âœ… é€šè¿‡ (10/10æ¬¡)

### æˆåŠŸç‡ç»Ÿè®¡
- **DNSè®°å½•åˆ›å»º**: 100% (20/20)
- **DNSç”Ÿæ•ˆæ£€æŸ¥**: 80% (16/20ï¼Œéƒ¨åˆ†è¶…è¿‡5åˆ†é’Ÿ)
- **é”™è¯¯å¤„ç†**: 100% (10/10)
- **æ•´ä½“æˆåŠŸç‡**: 93%

### è¾¹ç•Œæµ‹è¯•
- âœ… é‡å¤åˆ›å»ºåŒåè®°å½•ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰
- âœ… æ— æ•ˆå­åŸŸåæ ¼å¼ï¼ˆé”™è¯¯æç¤ºï¼‰
- âœ… APIé™æµå¤„ç†ï¼ˆé‡è¯•æœºåˆ¶ï¼‰
- âœ… ç½‘ç»œä¸­æ–­å¤„ç†ï¼ˆè¶…æ—¶é‡è¯•ï¼‰

---

## 5ï¸âƒ£ é—®é¢˜è®°å½•

### é—®é¢˜1: DNSç”Ÿæ•ˆæ—¶é—´ä¸ç¨³å®š
**æ—¶é—´**: 2025-01-07
**æè¿°**: DNSè®°å½•åˆ›å»ºåï¼Œç”Ÿæ•ˆæ—¶é—´åœ¨30ç§’åˆ°10åˆ†é’Ÿä¸ç­‰
**åŸå› **: Cloudflare DNSä¼ æ’­éœ€è¦æ—¶é—´ï¼Œä¸”ä¸åŒåœ°åŒºä¸ä¸€è‡´
**è§£å†³æ–¹æ¡ˆ**: å¢åŠ DNSæ£€æŸ¥è„šæœ¬ï¼Œæœ€å¤šç­‰å¾…5åˆ†é’Ÿ
**é¢„é˜²æªæ–½**: è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´ï¼Œæä¾›è¿›åº¦æç¤º
**å‚è€ƒé“¾æ¥**: [Cloudflare DNS Propagation](https://developers.cloudflare.com/dns/)

### é—®é¢˜2: IPv6è®°å½•é…ç½®é—®é¢˜
**æ—¶é—´**: 2025-01-08
**æè¿°**: ä½¿ç”¨`2606:4700::`åœ°å€æ— æ³•é€šè¿‡éªŒè¯
**åŸå› **: Cloudflareè¦æ±‚ä½¿ç”¨ç‰¹å®šçš„IPv6åœ°å€èŒƒå›´
**è§£å†³æ–¹æ¡ˆ**: æ”¹ç”¨`100::`åœ°å€ï¼ˆCloudflareä¿ç•™åœ°å€ï¼‰
**é¢„é˜²æªæ–½**: æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ï¼Œä½¿ç”¨æ¨èçš„åœ°å€èŒƒå›´

### é—®é¢˜3: CNAMEè®°å½•å†²çª
**æ—¶é—´**: 2025-01-09
**æè¿°**: wwwå­åŸŸåå·²æœ‰Aè®°å½•ï¼Œæ— æ³•åˆ›å»ºCNAME
**åŸå› **: DNSè§„èŒƒä¸å…è®¸åŒåçš„Aè®°å½•å’ŒCNAMEè®°å½•å…±å­˜
**è§£å†³æ–¹æ¡ˆ**: å…ˆåˆ é™¤æ—§è®°å½•ï¼Œå†åˆ›å»ºCNAME
**é¢„é˜²æªæ–½**: æ£€æŸ¥ç°æœ‰è®°å½•ï¼Œè‡ªåŠ¨æ¸…ç†å†²çª

---

## 6ï¸âƒ£ ä¾èµ–æ¸…å•

### å¤–éƒ¨æœåŠ¡
- **Cloudflare DNS API**
  - ç”¨é€”: DNSè®°å½•ç®¡ç†
  - æ–‡æ¡£: https://developers.cloudflare.com/api/
  - è”ç³»äºº: Cloudflare Support

- **Google Public DNS (8.8.8.8)**
  - ç”¨é€”: DNSç”Ÿæ•ˆéªŒè¯
  - æ–‡æ¡£: https://developers.google.com/speed/public-dns

### ç³»ç»Ÿå·¥å…·
- bash v4.0+
- curl v7.0+
- nslookup (DNSæŸ¥è¯¢å·¥å…·)
- jq (JSONå¤„ç†å·¥å…·)

### ç¯å¢ƒå˜é‡
```bash
# å¿…éœ€é…ç½®
CLOUDFLARE_ZONE_ID=your-zone-id
CLOUDFLARE_API_TOKEN=your-api-token

# å¯é€‰é…ç½®
DNS_CHECK_TIMEOUT=300  # DNSæ£€æŸ¥è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
DNS_CHECK_INTERVAL=1   # DNSæ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
```

---

## 7ï¸âƒ£ æˆåŠŸè¦ç´ 

### ä¸ºä»€ä¹ˆæˆåŠŸç‡é«˜ï¼Ÿ
1. **è‡ªåŠ¨åŒ–é…ç½®**: è„šæœ¬åŒ–é…ç½®ï¼Œå‡å°‘äººä¸ºé”™è¯¯
2. **çŠ¶æ€æ£€æŸ¥**: ä¸»åŠ¨æ£€æŸ¥DNSç”Ÿæ•ˆçŠ¶æ€
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯æç¤ºå’Œé‡è¯•æœºåˆ¶
4. **æ–‡æ¡£å®Œå–„**: æ¸…æ™°çš„ä½¿ç”¨è¯´æ˜å’Œé—®é¢˜æ’æŸ¥

### å…³é”®å†³ç­–ç‚¹
- **å†³ç­–1**: ä½¿ç”¨Cloudflare Proxiedæ¨¡å¼
  - åŸå› : è‡ªåŠ¨å¯ç”¨CDNå’ŒSSL
  - æƒè¡¡: æ— æ³•ä½¿ç”¨æŸäº›è‡ªå®šä¹‰DNSç‰¹æ€§

- **å†³ç­–2**: ç­‰å¾…DNSç”Ÿæ•ˆæœ€å¤š5åˆ†é’Ÿ
  - åŸå› : å¹³è¡¡ç”¨æˆ·ä½“éªŒå’Œå¯é æ€§
  - æƒè¡¡: éƒ¨åˆ†æƒ…å†µä¸‹å¯èƒ½éœ€è¦æ›´é•¿æ—¶é—´

### æœ€ä½³å®è·µ
- âœ… ä½¿ç”¨Cloudflare API Tokenè€ŒéGlobal API Key
- âœ… å¯ç”¨Proxiedæ¨¡å¼è·å¾—CDNå’ŒSSL
- âœ… åˆ›å»ºå¤šç§DNSè®°å½•ç±»å‹ï¼ˆAã€AAAAã€CNAMEï¼‰
- âœ… ä¸»åŠ¨æ£€æŸ¥DNSç”Ÿæ•ˆçŠ¶æ€

---

## 8ï¸âƒ£ ä½¿ç”¨æ–‡æ¡£

### å¿«é€Ÿå¼€å§‹

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
export CLOUDFLARE_ZONE_ID="your-zone-id"
export CLOUDFLARE_API_TOKEN="your-api-token"

# 2. è¿è¡ŒDNSé…ç½®è„šæœ¬
./configure-dns.sh drama satoshitech.xyz

# 3. æ£€æŸ¥DNSæ˜¯å¦ç”Ÿæ•ˆ
./check-dns.sh drama.satoshitech.xyz

# 4. è®¿é—®ç½‘ç«™
curl https://drama.satoshitech.xyz
```

### å¸¸è§ç”¨æ³•

#### ç”¨æ³•1: é…ç½®å•ä¸ªå­åŸŸå
```bash
./configure-dns.sh subdomain example.com
```

#### ç”¨æ³•2: æ‰¹é‡é…ç½®å¤šä¸ªå­åŸŸå
```bash
for subdomain in api cdn media; do
  ./configure-dns.sh $subdomain example.com
done
```

### é«˜çº§é…ç½®

#### è‡ªå®šä¹‰IPåœ°å€
```bash
# ä½¿ç”¨è‡ªå®šä¹‰IPv4åœ°å€
CUSTOM_IPV4="203.0.113.1" ./configure-dns.sh subdomain example.com

# ä½¿ç”¨è‡ªå®šä¹‰IPv6åœ°å€
CUSTOM_IPV6="2001:db8::1" ./configure-dns.sh subdomain example.com
```

---

## 9ï¸âƒ£ ç»´æŠ¤è®°å½•

### ç‰ˆæœ¬å†å²

#### v1.0.0 (2025-01-10)
- âœ¨ æ–°åŠŸèƒ½: è‡ªåŠ¨é…ç½®Aã€AAAAã€CNAMEè®°å½•
- âœ¨ æ–°åŠŸèƒ½: DNSç”Ÿæ•ˆçŠ¶æ€æ£€æŸ¥
- ğŸ“ æ–‡æ¡£: å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£å’Œé—®é¢˜æ’æŸ¥

### æ›´æ–°æ—¥å¿—
- 2025-01-10: åˆå§‹ç‰ˆæœ¬å®Œæˆ

### æœªæ¥æ”¹è¿›
- [ ] æ”¯æŒæ›´å¤šDNSè®°å½•ç±»å‹ï¼ˆMXã€TXTã€SRVï¼‰
- [ ] æ·»åŠ DNSè®°å½•æ‰¹é‡å¯¼å…¥åŠŸèƒ½
- [ ] æ”¯æŒå¤šä¸ªDNSæä¾›å•†ï¼ˆAWS Route53ã€é˜¿é‡Œäº‘DNSï¼‰
- [ ] æ·»åŠ DNSé…ç½®å›æ»šåŠŸèƒ½

---

## ğŸ”Ÿ å®Œæˆç¡®è®¤

### åŠŸèƒ½éªŒæ”¶æ¸…å•
- [x] æ‰€æœ‰éªŒæ”¶æ ‡å‡†å·²æ»¡è¶³
- [x] è„šæœ¬æµ‹è¯•é€šè¿‡ç‡ > 90%
- [x] é”™è¯¯å¤„ç†å®Œå–„
- [x] æ–‡æ¡£å®Œæ•´

### äº¤ä»˜ç‰©æ£€æŸ¥
- [x] è„šæœ¬ä»£ç å·²æäº¤
- [x] ä½¿ç”¨æ–‡æ¡£å·²å®Œå–„
- [x] é—®é¢˜æ’æŸ¥æŒ‡å—å·²ç¼–å†™
- [x] ç¤ºä¾‹é…ç½®å·²æä¾›

### ä¸Šçº¿ç¡®è®¤
- [x] ç”Ÿäº§ç¯å¢ƒæµ‹è¯•æˆåŠŸ
- [x] å¤šä¸ªåŸŸåéªŒè¯é€šè¿‡
- [x] å›¢é˜ŸåŸ¹è®­å®Œæˆ

---

## ğŸ“Š ç»Ÿè®¡æ•°æ®

- **æ€»å·¥æ—¶**: 4å¤©
- **ä»£ç è¡Œæ•°**: 350è¡Œ
- **æµ‹è¯•ç”¨ä¾‹æ•°**: 15ä¸ª
- **é¦–æ¬¡é…ç½®æˆåŠŸç‡**: 93%
- **DNSå¹³å‡ç”Ÿæ•ˆæ—¶é—´**: 2åˆ†é’Ÿ

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Cloudflare DNS APIæ–‡æ¡£](https://developers.cloudflare.com/api/)
- [DNSæœ€ä½³å®è·µ](https://developers.cloudflare.com/dns/manage-dns-records/best-practices/)
- [Cloudflare Workersè‡ªå®šä¹‰åŸŸå](https://developers.cloudflare.com/workers/configuration/routing/custom-domains/)

---

**æ–‡æ¡£çŠ¶æ€**: âœ… æ­¤æ–‡æ¡£å·²å®Œæˆå¹¶å½’æ¡£

**æœ€åæ›´æ–°**: 2025-01-10
**ä¸‹æ¬¡å®¡æŸ¥**: 2025-04-10
